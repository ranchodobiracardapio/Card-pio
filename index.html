<html lang="pt-BR">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Rancho do Bira - Nova Lima
  </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: "Inter", sans-serif;
      transition: background-color 0.3s ease;
      padding-bottom: 6rem; /* space for footer and cart preview */
      background-color: #f8fafc; /* branco gelo padr√£o */
    }
    /* Header background images */
    #header-bg-images {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }
    #header-bg-images img {
      position: absolute;
      opacity: 0.15;
      user-select: none;
      -webkit-user-drag: none;
      border-radius: 0.5rem;
      border: 4px solid rgba(255 255 255 / 0.3);
      box-sizing: border-box;
      animation: float 6s ease-in-out infinite;
      object-fit: cover;
    }
    #header-bg-images img:nth-child(2) {
      animation-delay: 2s;
    }
    #header-bg-images img:nth-child(3) {
      animation-delay: 4s;
    }
    #header-bg-images img:nth-child(4) {
      animation-delay: 1s;
    }
    #header-bg-images img:nth-child(5) {
      animation-delay: 3s;
    }
    @keyframes float {
      0%,
      100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-15px);
      }
    }
    /* Increase send icon size */
    #search-send-btn i {
      font-size: 1.25rem; /* 20px */
    }
    /* Custom container color for title and cart */
    .header-title-cart {
      background-color: #000000; /* Preto para o perfil da loja */
    }
    /* Splash animation container */
    #splash-art {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    #splash-art.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }
    #splash-art img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      margin-bottom: 1rem;
      animation: spin 2s linear infinite;
      border-radius: 0.5rem;
      box-shadow: 0 0 15px rgba(74, 124, 89, 0.7);
      background: white;
    }
    #splash-art p {
      font-weight: 600;
      color: #3e6b45;
      font-size: 1.25rem;
      text-align: center;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    /* Cart panel background white */
    #cart-panel {
      background-color: #ffffff; /* Fundo branco para o carrinho */
    }
    /* Override cart text colors for contrast */
    #cart-panel header h3,
    #cart-panel footer span,
    #cart-panel footer button,
    #cart-panel label {
      color: #4a7c59;
    }
    #cart-panel ul li {
      border-color: rgba(74 124 89 / 0.3);
    }
    #cart-panel ul li h4,
    #cart-panel ul li p {
      color: #4a7c59;
    }
    #cart-panel ul li button {
      color: #4a7c59;
    }
    #cart-panel ul li button:hover {
      color: #7ca17a;
    }
    /* Discreet background color selector */
    .bg-color-selector {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      z-index: 30;
      flex-wrap: wrap;
      max-width: 100vw;
      overflow-x: auto;
    }
    .bg-color-selector button {
      border-color: #d1d5db; /* Tailwind gray-300 */
      box-shadow: none;
      opacity: 0.6;
      transition: opacity 0.3s ease, border-color 0.3s ease;
      width: 1.5rem;
      height: 1.5rem;
      flex-shrink: 0;
    }
    .bg-color-selector button:hover,
    .bg-color-selector button:focus-visible {
      opacity: 1;
      border-color: #6b7280; /* Tailwind gray-500 */
      box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.5);
      outline: none;
    }
    .bg-color-selector button.ring-2 {
      opacity: 1;
      border-color: #2563eb; /* Tailwind blue-600 */
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.7);
    }
    /* Timer style */
    #promo-timer {
      font-weight: 700;
      color: #dc2626; /* Tailwind red-600 */
      font-size: 1rem;
      margin-left: auto;
      user-select: none;
      min-width: 90px;
      text-align: right;
    }
    /* Custom finalize button color */
    #cart-buy-btn {
      background-color: #d6336c; /* Tom rosa forte */
      color: white;
    }
    #cart-buy-btn:hover:not(:disabled) {
      background-color: #b02a5a; /* Tom rosa escuro */
      color: white;
    }
    #cart-buy-btn:disabled {
      background-color: #f9a8d4; /* Rosa claro para desabilitado */
      color: #fce7f3;
      cursor: not-allowed;
    }
    /* Cart preview fixed footer */
    #cart-preview {
      position: fixed;
      bottom: 3.75rem; /* above color selector */
      left: 0;
      right: 0;
      background: #4a7c59;
      color: white;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 1rem;
      z-index: 35;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.15);
      border-top-left-radius: 0.5rem;
      border-top-right-radius: 0.5rem;
    }
    #cart-preview button {
      background: #d6336c;
      color: white;
      padding: 0.375rem 1rem;
      border-radius: 0.375rem;
      font-weight: 700;
      font-size: 0.875rem;
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
    }
    #cart-preview button:hover {
      background-color: #b02a5a;
    }
  </style>
  <script>
   document.addEventListener("DOMContentLoaded", function () {
      const categories = [
        {
          id: "marmitas",
          label: "Marmitas",
          discount: "üç± Marmitas com acompanhamentos",
          discountColor: "text-green-700",
          items: [
  {
    name: "Marmita P",
    description: "Frango ou Churrasco\nArroz, Feij√£o, Macarr√£o\n+Adicionais do dia",
    price: 12.0,
    priceText: "R$ 12,00",
    img: "marmitap.png",
    alt: "Marmita pequena com frango ou churrasco, arroz, feij√£o, macarr√£o e adicionais do dia, foto realista em moldura quadrada com cantos arredondados",
    hasExtra: false,
    extraText: "",
    extraPrice: 0,
  },
  {
    name: "Marmita M",
    description: "Arroz, Feij√£o, Macarr√£o\nChurrasco + Adicionais do dia",
    price: 15.0,
    priceText: "R$ 15,00",
    img: "marmitam.jpg",
    alt: "Marmita m√©dia com arroz, feij√£o, macarr√£o, churrasco e adicionais do dia, foto realista em moldura quadrada com cantos arredondados",
    hasExtra: false,
    extraText: "",
    extraPrice: 0,
  },
  {
    name: "Marmita G",
    description: "Arroz, Feij√£o, Macarr√£o\nChurrasco e acompanhamentos do dia (exemplo)",
    price: 20.0,
    priceText: "R$ 20,00",
    img: "marmitag.jpg",
    alt: "Marmita grande com arroz, feij√£o, macarr√£o, churrasco e acompanhamentos do dia, foto realista em moldura quadrada com cantos arredondados",
    hasExtra: false,
    extraText: "",
    extraPrice: 0,
  },
],
        },
        {
          id: "bebidas",
          label: "Bebidas",
          discount: "ü•§ Bebidas Geladas",
          discountColor: "text-blue-600",
          items: [
            {
              name: "Coca-Cola Mini",
              description: "",
              price: 5.0,
              priceText: "R$ 5,00",
              img: "cocamini.png",
              alt:
                "lata pequena de Coca-Cola, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Guaran√° Antarctica",
              description: "",
              price: 5.0,
              priceText: "R$ 4,50",
              img: "guaranamini.png",
              alt:
                "Garrafa pequena de Guaran√° Antarctica, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Refriko 500 ml",
              description: "",
              price: 6.0,
              priceText: "R$ 5,00",
              img: "refriko.png",
              alt:
                "Garrafa de 500 ml de refrigerante Refriko, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Coca-Cola 1 litro",
              description: "",
              price: 8.0,
              priceText: "R$ 8,00",
              img: "cocal.png",
              alt:
                "Garrafa de 1 litro de Coca-Cola, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Coca-Cola 2 litros",
              description: "",
              price: 12.0,
              priceText: "R$ 12,00",
              img: "coca2l.png",
              alt:
                "Garrafa de 2 litros de Coca-Cola, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Tuba√≠na 2 litros",
              description: "",
              price: 10.0,
              priceText: "R$ 10,00",
              img: "tubaina2l.png",
              alt:
                "Garrafa de 2 litros de Tuba√≠na, refrigerante brasileiro, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
          ],
        },
        {
          id: "acompanhamentos",
          label: "Acompanhamentos",
          discount: "ü•ó Acompanhamentos do dia (exemplo)",
          discountColor: "text-yellow-600",
          items: [
            {
              name: "Frango Frito",
              description: "Exemplo de acompanhamento que pode vir na marmita",
              price: 0,
              priceText: "",
              img:
                "frango.png",
              alt:
                "Por√ß√£o de frango frito crocante, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Pur√™ de Batata",
              description: "Exemplo de acompanhamento que pode vir na marmita",
              price: 0,
              priceText: "",
              img:
                "file_00000000147061f5a4be4862937b87a9.png",
              alt:
                "Por√ß√£o de pur√™ de batata cremoso, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Carne Mo√≠da",
              description: "Exemplo de acompanhamento que pode vir na marmita",
              price: 0,
              priceText: "",
              img:
                "carne.png,
              alt:
                "Por√ß√£o de carne mo√≠da temperada, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
            {
              name: "Salada de Repolho com Cenoura",
              description: "Exemplo de acompanhamento que pode vir na marmita",
              price: 0,
              priceText: "",
              img:
                "salada.png,
              alt:
                "Por√ß√£o de salada fresca de repolho com cenoura ralada, foto realista em moldura quadrada com cantos arredondados",
              hasExtra: false,
              extraText: "",
              extraPrice: 0,
            },
          ],
        },
      ];

      const categoryButtons = document.querySelectorAll("#category-buttons button");
      const discountIcon = document.getElementById("discount-icon");
      const discountText = document.getElementById("discount-text");
      const productList = document.getElementById("product-list");
      const body = document.body;
      const colorButtons = document.querySelectorAll("div.bg-color-selector button[data-color]");
      const searchInput = document.getElementById("header-search");
      const searchSendBtn = document.getElementById("search-send-btn");
      const cartButton = document.getElementById("cart-button");
      const cartPanel = document.getElementById("cart-panel");
      const cartList = document.getElementById("cart-list");
      const cartTotal = document.getElementById("cart-total");
      const cartBuyBtn = document.getElementById("cart-buy-btn");
      const cartCountBadge = document.getElementById("cart-count-badge");
      const cartPreview = document.createElement("div");

      let cart = [];
      let paymentMethod = "Dinheiro";
      let deliveryMethod = "Entrega";
      let deliveryDistance = "1"; // default 1 km
      let deliveryFee = 0;
      let deliveryAddress = "";

      function saveCart() {
        localStorage.setItem("ranchoDoBiraCart", JSON.stringify(cart));
        localStorage.setItem("ranchoDoBiraPaymentMethod", paymentMethod);
        localStorage.setItem("ranchoDoBiraDeliveryMethod", deliveryMethod);
        localStorage.setItem("ranchoDoBiraDeliveryDistance", deliveryDistance);
        localStorage.setItem("ranchoDoBiraDeliveryAddress", deliveryAddress);
        updateCartCount();
      }

      function loadCart() {
        const saved = localStorage.getItem("ranchoDoBiraCart");
        if (saved) {
          try {
            cart = JSON.parse(saved);
          } catch {
            cart = [];
          }
        }
        const savedPayment = localStorage.getItem("ranchoDoBiraPaymentMethod");
        if (savedPayment) paymentMethod = savedPayment;
        const savedDelivery = localStorage.getItem("ranchoDoBiraDeliveryMethod");
        if (savedDelivery) deliveryMethod = savedDelivery;
        const savedDistance = localStorage.getItem("ranchoDoBiraDeliveryDistance");
        if (savedDistance) deliveryDistance = savedDistance;
        const savedAddress = localStorage.getItem("ranchoDoBiraDeliveryAddress");
        if (savedAddress) deliveryAddress = savedAddress;
        updateCartCount();
      }

      function updateCartCount() {
        const totalQty = cart.reduce((acc, cur) => acc + cur.quantity, 0);
        if (totalQty > 0) {
          cartCountBadge.textContent = totalQty;
          cartCountBadge.classList.remove("hidden");
        } else {
          cartCountBadge.classList.add("hidden");
        }
        updateCartPreview();
      }

      function calculateDeliveryFee() {
        if (deliveryMethod === "Retirada") {
          deliveryFee = 0;
          return;
        }
        const dist = Number(deliveryDistance);
        if (dist === 1) deliveryFee = 2;
        else if (dist === 3) deliveryFee = 4;
        else if (dist === 5) deliveryFee = 6;
        else if (dist === 7) deliveryFee = 10;
        else if (dist === 8) deliveryFee = 9;
        else deliveryFee = 0;
      }

      function renderCategory(categoryId) {
        const category = categories.find((c) => c.id === categoryId);
        if (!category) return;

        discountText.textContent = category.discount;
        discountIcon.className = `fas ${category.icon} ${category.discountColor} text-xl`;

        productList.innerHTML = "";
        category.items.forEach((item) => {
          const card = document.createElement("article");
          card.className =
            "bg-white rounded-xl shadow p-4 flex items-center space-x-4 cursor-default";
          card.setAttribute("role", "listitem");
          card.tabIndex = 0;

          // Image container with rounded border
          const imgContainer = document.createElement("div");
          imgContainer.className = "w-28 h-28 rounded-lg border-4 border-gray-200 overflow-hidden flex-shrink-0 flex items-center justify-center bg-white";

          const img = document.createElement("img");
          img.className = "object-cover w-full h-full";
          img.src = item.img;
          img.alt = item.alt;
          img.width = 112;
          img.height = 112;

          imgContainer.appendChild(img);

          // Text and button container
          const textButtonDiv = document.createElement("div");
          textButtonDiv.className = "flex flex-1 flex-col sm:flex-row sm:items-center sm:justify-between";

          // Text container
          const textDiv = document.createElement("div");
          textDiv.className = "text-center sm:text-left";

          const name = document.createElement("h3");
          name.className = "text-gray-900 font-semibold text-lg";
          name.textContent = item.name;

          const desc = document.createElement("p");
          desc.className = "text-gray-600 text-sm whitespace-pre-line mt-1";
          desc.textContent = item.description;

          const price = document.createElement("p");
          price.className = category.id === "acompanhamentos" ? "text-gray-500 italic mt-1" : "text-green-700 font-semibold text-lg mt-1";
          price.textContent = item.priceText || "";

          textDiv.appendChild(name);
          if(item.description) textDiv.appendChild(desc);
          textDiv.appendChild(price);

          // Add button only if not acompanhamentos (which are demo only)
          if(category.id !== "acompanhamentos"){
            const addButton = document.createElement("button");
            addButton.type = "button";
            addButton.className = "mt-3 sm:mt-0 bg-green-700 hover:bg-green-800 text-white font-semibold px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-1";
            addButton.textContent = "Adicionar";
            addButton.setAttribute("aria-label", `Adicionar ${item.name} ao carrinho`);

            addButton.addEventListener("click", () => {
              showSplashAnimation(() => {
                addToCart({...item});
              });
            });

            textButtonDiv.appendChild(textDiv);
            textButtonDiv.appendChild(addButton);
          } else {
            textButtonDiv.appendChild(textDiv);
          }

          card.appendChild(imgContainer);
          card.appendChild(textButtonDiv);

          productList.appendChild(card);
        });

        // Add "Pr√≥ximo" button for marmitas and acompanhamentos
        if(categoryId === "marmitas" || categoryId === "acompanhamentos"){
          const nextBtn = document.createElement("button");
          nextBtn.type = "button";
          nextBtn.className = "w-full mt-2 bg-black text-white font-semibold py-3 rounded-lg hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-black";
          nextBtn.textContent = "Pr√≥ximo";
          nextBtn.setAttribute("aria-label", "Ir para a pr√≥xima categoria");

          nextBtn.addEventListener("click", () => {
            // Find next category index
            const currentIndex = categories.findIndex(c => c.id === categoryId);
            const nextIndex = (currentIndex + 1) % categories.length;
            const nextCategory = categories[nextIndex];
            // Update tab buttons
            categoryButtons.forEach((b) => {
              b.classList.remove("border-green-700", "text-green-700", "font-bold");
              b.classList.add("text-gray-700", "font-semibold");
              b.setAttribute("aria-selected", "false");
            });
            const nextBtnTab = Array.from(categoryButtons).find(b => b.dataset.category === nextCategory.id);
            if(nextBtnTab){
              nextBtnTab.classList.add("border-green-700", "text-green-700", "font-bold");
              nextBtnTab.classList.remove("text-gray-700", "font-semibold");
              nextBtnTab.setAttribute("aria-selected", "true");
            }
            renderCategory(nextCategory.id);
          });

          productList.appendChild(nextBtn);
        }

        // Add "Ver Carrinho" button for bebidas
        if(categoryId === "bebidas"){
          const viewCartBtn = document.createElement("button");
          viewCartBtn.type = "button";
          viewCartBtn.className = "w-full mt-2 bg-green-700 text-white font-semibold py-3 rounded-lg hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-700";
          viewCartBtn.textContent = "Ver Carrinho";
          viewCartBtn.setAttribute("aria-label", "Abrir carrinho");

          viewCartBtn.addEventListener("click", () => {
            toggleCart();
          });

          productList.appendChild(viewCartBtn);
        }
      }

      function addToCart(item) {
        const existing = cart.find(c => c.item.name === item.name && c.item.price === item.price);
        if (existing) {
          existing.quantity++;
        } else {
          cart.push({item: item, quantity: 1});
        }
        saveCart();
        renderCart();
      }

      function removeFromCart(index) {
        cart.splice(index, 1);
        saveCart();
        renderCart();
      }

      function changeQuantity(index, delta) {
        const entry = cart[index];
        if (!entry) return;
        entry.quantity += delta;
        if (entry.quantity < 1) {
          removeFromCart(index);
        } else {
          saveCart();
          renderCart();
        }
      }

      function renderCart() {
        cartList.innerHTML = "";
        if (cart.length === 0) {
          const emptyMsg = document.createElement("p");
          emptyMsg.className = "text-green-700 text-center py-6";
          emptyMsg.textContent = "Seu carrinho est√° vazio.";
          cartList.appendChild(emptyMsg);
          cartTotal.textContent = "R$ 0,00";
          cartBuyBtn.disabled = true;
          cartBuyBtn.classList.add("opacity-50", "cursor-not-allowed");
          updateCartCount();
          renderPaymentAndDelivery();
          renderDeliveryMethod();
          renderDeliveryDistance();
          renderDeliveryFee();
          updateCartPreview();
          return;
        }

        cart.forEach((entry, index) => {
          const {item, quantity} = entry;

          const li = document.createElement("li");
          li.className = "flex items-center space-x-4 border-b border-green-700/30 py-3";

          const img = document.createElement("img");
          img.src = item.img;
          img.alt = item.alt;
          img.width = 60;
          img.height = 60;
          img.className = "w-16 h-16 rounded-lg object-cover flex-shrink-0";

          const infoDiv = document.createElement("div");
          infoDiv.className = "flex-1";

          const name = document.createElement("h4");
          name.className = "font-semibold text-green-700";
          name.textContent = item.name;

          const price = document.createElement("p");
          price.className = "text-green-500 font-semibold mt-1";
          const totalPrice = (item.price || 0) * quantity;
          price.textContent = `R$ ${totalPrice.toFixed(2)}`;

          infoDiv.appendChild(name);
          infoDiv.appendChild(price);

          const qtyControls = document.createElement("div");
          qtyControls.className = "flex items-center space-x-2";

          const btnMinus = document.createElement("button");
          btnMinus.type = "button";
          btnMinus.className = "bg-green-200 hover:bg-green-300 rounded px-2 py-1 text-green-700 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-700";
          btnMinus.setAttribute("aria-label", `Diminuir quantidade de ${item.name}`);
          btnMinus.textContent = "-";
          btnMinus.addEventListener("click", () => changeQuantity(index, -1));

          const qtyText = document.createElement("span");
          qtyText.className = "w-6 text-center font-semibold text-green-700";
          qtyText.textContent = quantity;

          const btnPlus = document.createElement("button");
          btnPlus.type = "button";
          btnPlus.className = "bg-green-200 hover:bg-green-300 rounded px-2 py-1 text-green-700 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-700";
          btnPlus.setAttribute("aria-label", `Aumentar quantidade de ${item.name}`);
          btnPlus.textContent = "+";
          btnPlus.addEventListener("click", () => changeQuantity(index, 1));

          const btnRemove = document.createElement("button");
          btnRemove.type = "button";
          btnRemove.className = "ml-4 text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-red-600";
          btnRemove.setAttribute("aria-label", `Remover ${item.name} do carrinho`);
          btnRemove.innerHTML = '<i class="fas fa-trash-alt"></i>';
          btnRemove.addEventListener("click", () => removeFromCart(index));

          qtyControls.appendChild(btnMinus);
          qtyControls.appendChild(qtyText);
          qtyControls.appendChild(btnPlus);
          qtyControls.appendChild(btnRemove);

          li.appendChild(img);
          li.appendChild(infoDiv);
          li.appendChild(qtyControls);

          cartList.appendChild(li);
        });

        calculateDeliveryFee();

        const total = cart.reduce(
          (acc, cur) => acc + (cur.item.price || 0) * cur.quantity,
          0
        ) + deliveryFee;

        cartTotal.textContent = `R$ ${total.toFixed(2)}`;
        cartBuyBtn.disabled = false;
        cartBuyBtn.classList.remove("opacity-50", "cursor-not-allowed");
        updateCartCount();
        renderPaymentAndDelivery();
        renderDeliveryMethod();
        renderDeliveryDistance();
        renderDeliveryFee();
        updateCartPreview();
      }

      function renderPaymentAndDelivery() {
        let container = document.getElementById("payment-delivery-container");
        if (!container) {
          container = document.createElement("div");
          container.id = "payment-delivery-container";
          container.className = "px-4 pb-4 border-t border-green-700/30 space-y-4";

          // Payment method
          const paymentDiv = document.createElement("div");
          paymentDiv.className = "flex flex-col";

          const paymentLabel = document.createElement("label");
          paymentLabel.className = "font-semibold text-green-700 mb-1";
          paymentLabel.setAttribute("for", "payment-method");
          paymentLabel.textContent = "Forma de Pagamento";

          const paymentSelect = document.createElement("select");
          paymentSelect.id = "payment-method";
          paymentSelect.className = "rounded border border-green-700 text-green-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-1";
          paymentSelect.setAttribute("aria-label", "Selecione a forma de pagamento");

          const paymentOptions = [
            {value: "Dinheiro", text: "Dinheiro"},
            {value: "Cart√£o de Cr√©dito", text: "Cart√£o de Cr√©dito"},
            {value: "Cart√£o de D√©bito", text: "Cart√£o de D√©bito"},
            {value: "Pix", text: "Pix"},
          ];

          paymentOptions.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.text;
            paymentSelect.appendChild(option);
          });

          paymentSelect.value = paymentMethod;

          paymentSelect.addEventListener("change", (e) => {
            paymentMethod = e.target.value;
            saveCart();
          });

          paymentDiv.appendChild(paymentLabel);
          paymentDiv.appendChild(paymentSelect);

          container.appendChild(paymentDiv);

          cartBuyBtn.parentElement.insertBefore(container, cartBuyBtn);
        } else {
          const paymentSelect = document.getElementById("payment-method");
          if (paymentSelect) paymentSelect.value = paymentMethod;
        }
      }

      function renderDeliveryMethod() {
        let container = document.getElementById("delivery-method-container");
        if (!container) {
          container = document.createElement("div");
          container.id = "delivery-method-container";
          container.className = "px-4 pb-4 border-t border-green-700/30 space-y-4";

          const label = document.createElement("label");
          label.className = "font-semibold text-green-700 mb-1";
          label.setAttribute("for", "delivery-method");
          label.textContent = "Retirada ou Entrega";

          const select = document.createElement("select");
          select.id = "delivery-method";
          select.className = "rounded border border-green-700 text-green-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-1";
          select.setAttribute("aria-label", "Selecione Retirada ou Entrega");

          const options = [
            {value: "Retirada", text: "Retirada"},
            {value: "Entrega", text: "Entrega"},
          ];

          options.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.text;
            select.appendChild(option);
          });

          select.value = deliveryMethod;

          select.addEventListener("change", (e) => {
            deliveryMethod = e.target.value;
            if(deliveryMethod === "Retirada"){
              deliveryDistance = "";
            } else if(!deliveryDistance){
              deliveryDistance = "1";
            }
            saveCart();
            renderCart();
          });

          container.appendChild(label);
          container.appendChild(select);

          const paymentContainer = document.getElementById("payment-delivery-container");
          if (paymentContainer && paymentContainer.parentElement) {
            paymentContainer.parentElement.insertBefore(container, cartBuyBtn);
          } else {
            cartBuyBtn.parentElement.insertBefore(container, cartBuyBtn);
          }
        } else {
          const select = document.getElementById("delivery-method");
          if (select) select.value = deliveryMethod;
        }
      }

      function renderDeliveryDistance() {
        let container = document.getElementById("delivery-distance-container");
        if (!container) {
          container = document.createElement("div");
          container.id = "delivery-distance-container";
          container.className = "px-4 pb-4 border-t border-green-700/30 space-y-4";

          const label = document.createElement("label");
          label.className = "font-semibold text-green-700 mb-1";
          label.setAttribute("for", "delivery-distance");
          label.textContent = "Dist√¢ncia da loja (km)";

          const select = document.createElement("select");
          select.id = "delivery-distance";
          select.className = "rounded border border-green-700 text-green-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-1";
          select.setAttribute("aria-label", "Selecione a dist√¢ncia da loja");

          const options = [
            {value: "1", text: "1 km"},
            {value: "3", text: "3 km"},
            {value: "5", text: "5 km"},
            {value: "7", text: "7 km"},
            {value: "8", text: "8 km"},
          ];

          options.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.text;
            select.appendChild(option);
          });

          select.value = deliveryDistance || "1";

          select.addEventListener("change", (e) => {
            deliveryDistance = e.target.value;
            saveCart();
            renderCart();
          });

          container.appendChild(label);
          container.appendChild(select);

          const deliveryMethodContainer = document.getElementById("delivery-method-container");
          if (deliveryMethodContainer && deliveryMethodContainer.parentElement) {
            deliveryMethodContainer.parentElement.insertBefore(container, cartBuyBtn);
          } else {
            cartBuyBtn.parentElement.insertBefore(container, cartBuyBtn);
          }
        } else {
          const select = document.getElementById("delivery-distance");
          if (select) select.value = deliveryDistance || "1";
        }

        // Show or hide distance selector based on delivery method
        const distanceContainer = document.getElementById("delivery-distance-container");
        if (distanceContainer) {
          if (deliveryMethod === "Entrega") {
            distanceContainer.style.display = "block";
          } else {
            distanceContainer.style.display = "none";
          }
        }
      }

      function renderDeliveryFee() {
        let container = document.getElementById("delivery-fee-container");
        if (!container) {
          container = document.createElement("div");
          container.id = "delivery-fee-container";
          container.className = "px-4 pb-4 border-t border-green-700/30 space-y-1";

          const label = document.createElement("p");
          label.className = "font-semibold text-green-700";
          label.textContent = "Taxa de Entrega:";

          const feeValue = document.createElement("p");
          feeValue.id = "delivery-fee-value";
          feeValue.className = "text-green-700";

          container.appendChild(label);
          container.appendChild(feeValue);

          const deliveryDistanceContainer = document.getElementById("delivery-distance-container");
          if (deliveryDistanceContainer && deliveryDistanceContainer.parentElement) {
            deliveryDistanceContainer.parentElement.insertBefore(container, cartBuyBtn);
          } else {
            cartBuyBtn.parentElement.insertBefore(container, cartBuyBtn);
          }
        }
        const feeValue = document.getElementById("delivery-fee-value");
        if (feeValue) {
          feeValue.textContent = deliveryMethod === "Retirada" ? "R$ 0,00" : (deliveryFee === 0 ? "R$ 0,00" : `R$ ${deliveryFee.toFixed(2)}`);
        }
      }

      function toggleCart() {
        if (cartPanel.classList.contains("translate-x-full")) {
          cartPanel.classList.remove("translate-x-full");
          cartPanel.classList.add("translate-x-0");
          cartPanel.setAttribute("aria-hidden", "false");
          cartPanel.focus();
        } else {
          cartPanel.classList.add("translate-x-full");
          cartPanel.classList.remove("translate-x-0");
          cartPanel.setAttribute("aria-hidden", "true");
        }
      }

      function sendCartOrder() {
        if (cart.length === 0) return;
        let message = "Quero esse pedido:\n";
        cart.forEach(({ item, quantity }) => {
          const priceText = item.priceText ? ` - ${item.priceText}` : "";
          message += `*${item.name}* x${quantity}${priceText}\n`;
        });
        const total = cart.reduce(
          (acc, cur) => acc + (cur.item.price || 0) * cur.quantity,
          0
        ) + deliveryFee;
        message += `\nTotal: R$ ${total.toFixed(2)}`;
        message += `\nForma de pagamento: ${paymentMethod}`;
        message += `\nRetirada ou Entrega: ${deliveryMethod}`;
        message += `\nDist√¢ncia da loja: ${deliveryMethod === "Entrega" ? deliveryDistance + " km" : "N/A"}`;
        message += `\nTaxa de entrega: R$ ${deliveryMethod === "Retirada" ? "0,00" : deliveryFee.toFixed(2)}`;
        const encodedText = encodeURIComponent(message);
        window.location.href = `https://wa.me/67992526860?text=${encodedText}`;
      }

      // Splash animation show/hide
      const splashArt = document.createElement("div");
      splashArt.id = "splash-art";
      splashArt.setAttribute("aria-live", "polite");
      splashArt.setAttribute("role", "alert");
      splashArt.innerHTML = `
        <img src="logo-bira.jpg" alt="Logo Rancho do Bira estilizado" />
        <p>Adicionando ao carrinho...</p>
      `;
      document.body.appendChild(splashArt);

      function showSplashAnimation(callback) {
        splashArt.classList.add("show");
        setTimeout(() => {
          splashArt.classList.remove("show");
          if (typeof callback === "function") callback();
        }, 1500);
      }

      categoryButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          categoryButtons.forEach((b) => {
            b.classList.remove("border-green-700", "text-green-700", "font-bold");
            b.classList.add("text-gray-700", "font-semibold");
            b.setAttribute("aria-selected", "false");
          });
          btn.classList.add("border-green-700", "text-green-700", "font-bold");
          btn.classList.remove("text-gray-700", "font-semibold");
          btn.setAttribute("aria-selected", "true");
          renderCategory(btn.dataset.category);
        });
      });

      // Initialize first category
      renderCategory("marmitas");

      // Background color selector logic
      colorButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const color = btn.getAttribute("data-color");
          let adjustedColor = color;
          if (color.toLowerCase() === "#ec4899") {
            adjustedColor = "#a3b18a"; // softer greenish for pink button
          }
          body.style.backgroundColor = adjustedColor;

          colorButtons.forEach((b) => b.classList.remove("ring-2", "ring-offset-1"));
          btn.classList.add("ring-2", "ring-offset-1");
        });
      });

      // Set default background color to branco gelo (#f8fafc)
      body.style.backgroundColor = "#f8fafc";
      const defaultBtn = document.querySelector("div.bg-color-selector button[data-color='#f8fafc']");
      if (defaultBtn) {
        defaultBtn.classList.add("ring-2", "ring-offset-1");
      }

      function sendSearchText() {
        const text = searchInput.value.trim();
        if (text.length === 0) return;
        const message = `Quero esse pedido: ${text}`;
        const encodedText = encodeURIComponent(message);
        window.location.href = `https://wa.me/67992526860?text=${encodedText}`;
      }

      searchSendBtn.addEventListener("click", sendSearchText);
      searchInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendSearchText();
        }
      });

      cartButton.addEventListener("click", toggleCart);
      cartBuyBtn.addEventListener("click", sendCartOrder);

      document.getElementById("cart-close-btn").addEventListener("click", () => {
        const cartPanel = document.getElementById("cart-panel");
        cartPanel.classList.add("translate-x-full");
        cartPanel.classList.remove("translate-x-0");
        cartPanel.setAttribute("aria-hidden", "true");
        document.getElementById("cart-button").focus();
      });

      cartPanel.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          toggleCart();
          cartButton.focus();
        }
      });

      // Cart preview element
      cartPreview.id = "cart-preview";
      cartPreview.setAttribute("aria-live", "polite");
      cartPreview.setAttribute("role", "region");
      cartPreview.setAttribute("aria-label", "Resumo do carrinho");
      cartPreview.innerHTML = `
        <div id="cart-preview-info" class="flex items-center gap-4">
          <i class="fas fa-shopping-bag text-xl"></i>
          <span id="cart-preview-qty">0 itens</span>
          <span id="cart-preview-total">R$ 0,00</span>
        </div>
        <button id="cart-preview-button" type="button" aria-label="Ver sacola">Ver sacola</button>
      `;
      document.body.appendChild(cartPreview);

      const cartPreviewQty = document.getElementById("cart-preview-qty");
      const cartPreviewTotal = document.getElementById("cart-preview-total");
      const cartPreviewButton = document.getElementById("cart-preview-button");

      cartPreviewButton.addEventListener("click", () => {
        toggleCart();
      });

      function updateCartPreview() {
        const totalQty = cart.reduce((acc, cur) => acc + cur.quantity, 0);
        const totalPrice = cart.reduce((acc, cur) => acc + (cur.item.price || 0) * cur.quantity, 0) + deliveryFee;
        cartPreviewQty.textContent = totalQty === 1 ? "1 item" : `${totalQty} itens`;
        cartPreviewTotal.textContent = `R$ ${totalPrice.toFixed(2)}`;
        if(totalQty > 0){
          cartPreview.style.display = "flex";
        } else {
          cartPreview.style.display = "none";
        }
      }

      loadCart();
      renderCart();
    });
  </script>
 </head>
 <body class="min-h-screen flex flex-col transition-colors duration-300 relative">
  <header class="relative rounded-b-[40px] px-4 pt-6 pb-4 shadow-lg z-20 overflow-hidden header-title-cart">
   <div aria-hidden="true" id="header-bg-images">
    <img alt="Imagem decorativa de marmita com comida caseira, foto realista com bordas arredondadas e opacidade baixa" height="80" src="https://storage.googleapis.com/a1aa/image/ca829c8a-b224-4a17-2e46-a382345e5830.jpg" style="top: 10%; left: 5%; width: 80px; height: 80px" width="80"/>
    <img alt="Imagem decorativa de marmita com arroz e feij√£o, foto realista com bordas arredondadas e opacidade baixa" height="100" src="https://storage.googleapis.com/a1aa/image/e3c0cf7a-2f43-41e9-3cf2-757f67ef1aea.jpg" style="top: 40%; left: 20%; width: 100px; height: 100px" width="100"/>
    <img alt="Imagem decorativa de marmita com salada fresca, foto realista com bordas arredondadas e opacidade baixa" height="90" src="https://storage.googleapis.com/a1aa/image/7ec9574f-94e8-46d0-e51d-abf4cca30a07.jpg" style="top: 15%; right: 10%; width: 90px; height: 90px" width="90"/>
    <img alt="Imagem decorativa de marmita com carne assada, foto realista com bordas arredondadas e opacidade baixa" height="80" src="https://storage.googleapis.com/a1aa/image/0be6aee5-e96e-4bf0-e76f-4f12f41dc19b.jpg" style="top: 60%; right: 5%; width: 80px; height: 80px" width="80"/>
    <img alt="Imagem decorativa de marmita com pur√™ de batata, foto realista com bordas arredondadas e opacidade baixa" height="70" src="https://storage.googleapis.com/a1aa/image/80d7fc16-d206-4013-fbee-cd9d6c9f3bb9.jpg" style="top: 75%; left: 10%; width: 70px; height: 70px" width="70"/>
   </div>
   <form class="relative flex items-center bg-white rounded-full px-3 py-2 text-gray-400 text-sm font-normal z-10" onsubmit="return false">
    <input aria-label="Campo de busca" class="w-full outline-none text-gray-400 placeholder-gray-400 text-sm font-normal bg-transparent pr-10" id="header-search" placeholder="O que voc√™ quer pedir hoje?" type="search"/>
    <button aria-label="Enviar busca" class="absolute right-2 text-gray-400 hover:text-green-700 focus:outline-none focus:text-green-700" id="search-send-btn" tabindex="0" type="button">
     <i class="fas fa-paper-plane"></i>
    </button>
   </form>
   <div class="flex items-center mt-4 rounded-[30px] px-4 py-2 text-white font-semibold text-lg z-10 relative">
    <div class="flex items-center justify-center w-10 h-10 rounded-full bg-black mr-3 overflow-hidden">
     <img alt="Logo Rancho do Bira" class="w-full h-full object-cover" height="40" src="logo-bira.jpg" width="40"/>
    </div>
    <span class="truncate flex-1">
     Rancho do Bira - Nova Lima
    </span>
    <button aria-label="Abrir carrinho" class="relative text-white focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-700" id="cart-button" title="Abrir carrinho" type="button">
     <i class="fas fa-shopping-cart text-xl"></i>
     <span class="hidden absolute -top-1 -right-3 bg-yellow-400 text-black rounded-full text-xs font-bold w-5 h-5 flex items-center justify-center" id="cart-count-badge">0</span>
    </button>
   </div>
   <p class="text-white text-xs mt-1 ml-14 flex items-center gap-1 z-10 relative">
    <i class="fas fa-coins"></i>
    Pedido m√≠nimo: R$ 12,00
   </p>
  </header>
  <nav class="bg-white mt-4 mx-4 rounded-xl shadow flex justify-between text-sm font-semibold text-gray-700 px-4 overflow-x-auto z-10 relative" id="category-buttons" role="tablist">
   <button aria-selected="true" class="flex items-center space-x-1 border-b-2 border-green-700 text-green-700 font-bold pb-2 whitespace-nowrap" data-category="marmitas" role="tab" type="button">Marmitas</button>
   <button class="pb-2 hover:text-green-700 transition font-semibold text-gray-700 whitespace-nowrap" data-category="bebidas" role="tab" type="button">Bebidas</button>
   <button class="pb-2 hover:text-green-700 transition font-semibold text-gray-700 whitespace-nowrap" data-category="acompanhamentos" role="tab" type="button">Acompanhamentos</button>
  </nav>
  <section aria-live="polite" class="bg-white mt-4 mx-4 rounded-xl shadow flex items-center px-4 py-3 space-x-3 z-10 relative">
   <i class="fas fa-box text-green-700 text-xl" id="discount-icon"></i>
   <h2 class="text-green-700 font-bold text-lg" id="discount-text">üç± Marmitas com acompanhamentos</h2>
  </section>
  <main class="flex-1 overflow-y-auto mt-4 mx-4 space-y-4 pb-24 relative z-10" id="product-list" role="list"></main>
  <aside aria-hidden="true" aria-label="Carrinho de compras" class="fixed top-0 right-0 h-full w-80 max-w-full shadow-xl transform translate-x-full transition-transform duration-300 flex flex-col z-40" id="cart-panel" style="background-color: #ffffff;" tabindex="-1">
   <header class="flex items-center justify-between p-4 border-b border-green-700/30">
    <h3 class="text-lg font-semibold text-green-700">Carrinho</h3>
    <button aria-label="Fechar carrinho" class="text-green-700 hover:text-green-900 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-700" id="cart-close-btn" type="button">
     <i class="fas fa-times text-xl"></i>
    </button>
   </header>
   <ul class="flex-1 overflow-y-auto divide-y divide-green-700/30 p-4" id="cart-list" tabindex="0"></ul>
   <div class="px-4 pb-4 border-t border-green-700/30 space-y-4" id="payment-delivery-container"></div>
   <footer class="p-4 border-t border-green-700/30">
    <div class="flex flex-col space-y-2">
     <div class="flex justify-between items-center">
      <span aria-atomic="true" aria-live="polite" class="font-semibold text-green-700 text-lg" id="cart-total">R$ 0,00</span>
     </div>
     <button class="w-full bg-[#d6336c] text-white font-semibold py-3 rounded-lg hover:bg-[#b02a5a] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[#b02a5a] disabled:opacity-50 disabled:cursor-not-allowed" disabled="" id="cart-buy-btn" type="button">Finalizar Compra</button>
    </div>
   </footer>
  </aside>
  <div class="bg-color-selector" role="region" aria-label="Seletor de cor do plano de fundo">
   <button aria-label="Branco Gelo" class="w-6 h-6 rounded-full bg-[#f8fafc] border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[#f8fafc]" data-color="#f8fafc" type="button"></button>
   <button aria-label="Verde" class="w-6 h-6 rounded-full bg-green-500 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-green-500" data-color="#22c55e" type="button"></button>
   <button aria-label="Azul" class="w-6 h-6 rounded-full bg-[#0a7fff] border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[#0a7fff]" data-color="#0a7fff" type="button"></button>
   <button aria-label="Rosa" class="w-6 h-6 rounded-full bg-pink-500 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-pink-500" data-color="#ec4899" type="button"></button>
   <button aria-label="Amarelo" class="w-6 h-6 rounded-full bg-yellow-400 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-400" data-color="#facc15" type="button"></button>
   <button aria-label="Cinza" class="w-6 h-6 rounded-full bg-gray-400 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-400" data-color="#9ca3af" type="button"></button>
   <button aria-label="Laranja" class="w-6 h-6 rounded-full bg-orange-500 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-orange-500" data-color="#f97316" type="button"></button>
   <button aria-label="Vermelho" class="w-6 h-6 rounded-full bg-red-600 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-red-600" data-color="#dc2626" type="button"></button>
   <button aria-label="Roxo" class="w-6 h-6 rounded-full bg-purple-600 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-purple-600" data-color="#7c3aed" type="button"></button>
   <button aria-label="Turquesa" class="w-6 h-6 rounded-full bg-teal-500 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-teal-500" data-color="#14b8a6" type="button"></button>
   <button aria-label="Marrom" class="w-6 h-6 rounded-full bg-yellow-900 border-2 border-white shadow-md hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-900" data-color="#78350f" type="button"></button>
  </div>
 </body>
</html>
